<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>AI Models and Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
  <h1 class="text-center">AI Models and Listening Ports</h1>
  <p class="text-center"><a href="/" class="btn btn-link">Back to Main</a></p>

  <div class="row justify-content-center">
    <div class="col-md-8">
      <h2>Model List</h2>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Model Name</th>
            <th>Route</th>
            <th>Source Port</th>
            <th>Proxy Port</th>
            <th>Subdomain</th>
            <th>Chat</th>
          </tr>
        </thead>
        <tbody>
          <% models.forEach(function(model) { %>
            <tr>
              <td><%= model.name %></td>
              <td><%= model.route %></td>
              <td><%= model.sourcePort %></td>
              <td><%= model.proxyPort %></td>
              <td><a href="http://<%= model.subdomain %>"><%= model.subdomain %></a></td>
              <td><a href="/chat/<%= model.route %>" class="btn btn-sm btn-primary">Chat with <%= model.name %></a></td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="row justify-content-center mt-5">
    <div class="col-md-8">
      <h2>Generate CURL Command</h2>
      <form id="curlForm">
        <div class="mb-3">
          <label for="modelSelect" class="form-label">Select Model</label>
          <select id="modelSelect" class="form-select">
            <% models.forEach(function(model) { %>
              <option value="<%= model.route %>" data-proxy-port="<%= model.proxyPort %>"><%= model.name %> (Proxy Port: <%= model.proxyPort %>)</option>
            <% }); %>
          </select>
        </div>
        <div class="mb-3">
          <label for="questionInput" class="form-label">Enter Your Question</label>
          <input type="text" id="questionInput" class="form-control" placeholder="e.g., Why is the sky blue?" required>
        </div>
        <button type="button" class="btn btn-primary" onclick="generateCurl()">Generate CURL</button>
      </form>
      <div id="curlResponse" class="mt-4 bg-light p-3" style="word-break: break-all;"></div>
    </div>
  </div>
</div>

<script>
function generateCurl() {
  const modelSelect = document.getElementById('modelSelect');
  const selectedOption = modelSelect.options[modelSelect.selectedIndex];
  const model = selectedOption.value;
  const proxyPort = selectedOption.getAttribute('data-proxy-port');
  const question = document.getElementById('questionInput').value.trim();

  if (!question) {
    alert('Please enter a question.');
    return;
  }

  const curlCommand = `curl -X POST http://localhost:${proxyPort}/api/chat \\
  -H "Content-Type: application/json" \\
  -d '{
    "model": "${model}",
    "messages": [
      {
        "role": "user",
        "content": "${question}"
      }
    ]
  }'`;

  document.getElementById('curlResponse').innerText = curlCommand;
}
</script>
</body>
</html>